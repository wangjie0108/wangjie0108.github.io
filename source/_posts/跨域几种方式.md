---
title: 跨域几种方式
date: 2018-6-13 20:18:25
categories: 
    - '前端'
    - '跨域'
tags: 
    - '跨域'
---
## 什么是跨域
1. 一个域名组成： 协议`(http://)` 子域名 `(www)`  .  主域名`(xyz.com)` : 端口号`(8080)` / 请求资源地址`(scripts/jquery.js)`
2. javascript 处于安全考虑，不允许跨域调用其他页面的对象。
3. 简单的讲，因为JavaScript同源策略的限制，`a.com`域名下的js无法操作`b.com`或是`c.a.com`域名下的对象。即：当协议、子域名，主域名、端口号中任意一个不相同时，都是不同域。不同域之间相互请求资源，就是'跨域'。
4. 但是需要注意：**跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了**
5. 跨域是由于收到了同源策略的限制，同源策略要求协议、域名、端口号完全一致才能正常通信。

## 特别注意：
第一、 如果协议和端口造成的跨域问题，‘前台’无能为力。
第二、 在跨域问题上，域仅仅是通过‘协议、域名、端口必须匹配’ 来识别而不会根据域名对应的IP地址是否相同来判断

## 什么是同源策略

同源策略限制一个源加载的文档或者脚本如何与来自另一个源的资源进行交互。用于隔离潜在恶意文件的关键的安全机制。它的存在可以保护用户隐私信息，防止身份伪造等（读取cookie）

## 同源策略限制的内容：
   - `cookie`、`LocalStorage`、`IndexedDB`等储存性内容
   - DOM节点
   - `ajax`请求不能发送

## 有三个标签是允许跨域加载资源的：
```javascript
   - <img src="" alt="">
   - <script src=""></script>
   - <link rel="stylesheet" href="">
```

## 处理跨域方法
1. `JSONP`
- 原理：利用`<script>`元素的这个开放策略，网页可以得到从其他来源动态产生的`json`数据。`json`请求需要对方的服务器做支持才可以；
- `JSONP` 发送的不是 `Ajax` 请求
- 缺点：不支持 `Post` 请求，仅支持`get`方法具有局限性；
- 优点： 兼容性好，可用于解决主流浏览器的跨域数据访问的问题。

2. CORS
- 原理：如果要启用 CORS 跨域资源共享，关键在于服务器端，只要服务器支持CORS跨域资源共享，则浏览器肯定能够正常访问 这种 CORS 接口；而且，客户端在发送 Ajax的时候，就像发送普通AJax一样，没有任何代码上的变化
- 发送的是ajax请求
- 支持ajax跨域
- 优点：功能更强大支持各种`HTTP Method`
- 缺点：CORS要求浏览器（IE>10）和服务器同时支持，是跨域的根本解决方法，由浏览器自动完成，由此，兼容性不如 JSONP
- `header(" Access-Control-Allow-Origin:* ");`
- `header(" Access-Control-Allow-Methods:post,get ");`

3. node搭建服务器（-- 大胆的想法 --）
- 跨域只存在于浏览器之间，服务器之间不存在跨域之说，用node搭建本地服务器，ajax请求本地服务器，通过本地服务器去请求外部的接口


