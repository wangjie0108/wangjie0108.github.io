---
title: 移动端-点透
date: 2018-4-30 14:41:56
categories:
    - 前端
    - 移动端
tags:
    - 移动端
---
# 什么是点透
当A/B两个层上下z轴重叠，上层的A点击后消失或移开，并且B元素本身有默认click事件（如a标签）或绑定了click事件。在这种情况下，点击A/B重叠的部分，就会出现点透的现象。(来源于百度😂)

# 点透出现原因
事件的触发顺序为: touchstart => touchmove => touchend => click 亦即click的触发是有延迟的，这个时间大概在300ms左右。

当手指触摸到屏幕的时候，系统生成两个事件，一个是touch 一个是click，touch先执行，touch执行完成后，A从DOM树上面消失了，而且由于移动端click还有延迟300ms左右的关系，当系统要触发click的时候，发现在用户点击的位置上面，目前离用户最近的元素是B，所以就直接把click事件作用在B元素上面了。
# 解决方式
+ 方式一：使用github上的第三方开源[fastclick](https://github.com/ftlabs/fastclick)库解决
引入`fastclick.js`，原生js直接添加如下代码：
```javascript
window.addEventListener( "load", function() {
    FastClick.attach( document.body );
}, false )
```
`jQuery`或者`zepto`加上如下代码：
```javascript
$(function() {
FastClick.attach(document.body);
})
```
`require`的话这样：
```JavaScript
const FastClick = require('fastclick')
FastClick.attach(document.body, options)
```
+ 方法二：用touchend代替tap事件并阻止掉touchend的默认行为preventDefault()
```JavaScript
$('ele').on('touchend', function(event) {
    // TODO
    e.preventDefault()
})
```
+ 方法三： 延时300ms
```javascript
$('ele').on('tap', function(event) {
    setTimeout(() => {
        // TODO
    }, 340)
})
```
注意: `zepto` 的`tap`事件是有点透问题的，但是**最新版**的`zepto`已经修复了这个问题。